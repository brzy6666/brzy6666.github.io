<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹çˆ±è®¡æ—¶å™¨ - è®°å½•æˆ‘ä»¬çš„çˆ±æƒ…æ—¶å…‰</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <!-- Tailwind é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ff6b8b',
                        secondary: '#a267ac',
                        light: '#fff5f7',
                        dark: '#4a4a4a',
                        online: '#4ade80',
                        offline: '#9ca3af'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'typing': 'typing 1.5s steps(40, end)',
                        'blink-caret': 'blink-caret .75s step-end infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        typing: {
                            'from': { width: '0' },
                            'to': { width: '100%' }
                        },
                        blinkCaret: {
                            'from, to': { borderColor: 'transparent' },
                            '50%': { borderColor: 'currentColor' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            }
            .glass {
                background: rgba(255, 255, 255, 0.25);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .heart-beat {
                animation: heartBeat 1.5s ease-in-out infinite;
            }
            @keyframes heartBeat {
                0% { transform: scale(1); }
                14% { transform: scale(1.1); }
                28% { transform: scale(1); }
                42% { transform: scale(1.15); }
                70% { transform: scale(1); }
            }
            .chat-bubble-left {
                border-radius: 18px 18px 18px 0;
            }
            .chat-bubble-right {
                border-radius: 18px 18px 0 18px;
            }
            .typing-indicator {
                display: inline-flex;
                align-items: center;
            }
            .typing-indicator span {
                height: 8px;
                width: 8px;
                background-color: #a267ac;
                border-radius: 50%;
                display: inline-block;
                margin: 0 1px;
                opacity: 0.6;
                animation: typing 1.4s infinite both;
            }
            .typing-indicator span:nth-child(2) {
                animation-delay: 0.2s;
            }
            .typing-indicator span:nth-child(3) {
                animation-delay: 0.4s;
            }
            @keyframes typing {
                0% { transform: translateY(0); }
                50% { transform: translateY(-5px); }
                100% { transform: translateY(0); }
            }
            .bg-upload {
                position: relative;
                overflow: hidden;
                cursor: pointer;
            }
            .bg-upload input[type="file"] {
                position: absolute;
                top: 0;
                right: 0;
                min-width: 100%;
                min-height: 100%;
                font-size: 100px;
                text-align: right;
                filter: alpha(opacity=0);
                opacity: 0;
                outline: none;
                background: white;
                cursor: pointer;
                display: block;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 to-purple-100 min-h-screen font-sans">
    <!-- èƒŒæ™¯è£…é¥° -->
    <div id="background-container" class="fixed inset-0 overflow-hidden pointer-events-none z-0 bg-gradient-to-br from-pink-100 to-purple-100">
        <!-- èƒŒæ™¯å›¾ç‰‡ -->
        <div id="background-image" class="absolute inset-0 bg-cover bg-center opacity-0 transition-opacity duration-500"></div>
        
        <!-- è£…é¥°å…ƒç´  -->
        <div class="absolute top-10 left-10 w-20 h-20 bg-pink-300 rounded-full opacity-20 animate-float"></div>
        <div class="absolute top-40 right-20 w-32 h-32 bg-purple-300 rounded-full opacity-20 animate-float" style="animation-delay: 1s;"></div>
        <div class="absolute bottom-20 left-1/4 w-24 h-24 bg-pink-300 rounded-full opacity-20 animate-float" style="animation-delay: 2s;"></div>
        <div class="absolute bottom-40 right-1/3 w-16 h-16 bg-purple-300 rounded-full opacity-20 animate-float" style="animation-delay: 0.5s;"></div>
        
        <!-- èƒŒæ™¯ä¸Šä¼ æŒ‰é’® -->
        <div class="absolute top-4 right-4 z-10 bg-upload">
            <button class="bg-white bg-opacity-80 p-2 rounded-full shadow-md hover:bg-opacity-100 transition-all duration-300">
                <i class="fa fa-image text-primary"></i>
            </button>
            <input type="file" id="background-upload" accept="image/*" class="hidden">
        </div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="container mx-auto px-4 py-8 relative z-10">
        <!-- é¡¶éƒ¨æƒ…ä¾£å¤´åƒ -->
        <div class="flex justify-center mb-8 relative">
            <div class="relative group">
                <img id="couple-avatar" src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/2c3f3c2f280a4d0f9c1be8e8214655c1~tplv-a9rns2rl98-image.image?lk3s=8e244e95&rcl=20260113111554A0EC2ADB115E7F82485B&rrcfp=f06b921b&x-expires=1770866177&x-signature=SGVZJvPhYi8BPmCvsJTiMFCA9bo%3D" alt="æƒ…ä¾£å¤´åƒ" class="w-32 h-32 object-contain rounded-full border-4 border-white shadow-lg">
                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 rounded-full transition-all duration-300 flex items-center justify-center">
                    <label for="avatar-upload" class="text-white opacity-0 group-hover:opacity-100 transition-opacity duration-300 cursor-pointer">
                        <i class="fa fa-camera text-2xl"></i>
                    </label>
                    <input type="file" id="avatar-upload" accept="image/*" class="hidden">
                </div>
            </div>

            <!-- èŠå¤©åŠŸèƒ½ -->
            <div id="chat-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æˆ‘ä»¬çš„èŠå¤©</h3>
                    <div class="flex items-center">
                        <span id="partner-status" class="inline-block w-3 h-3 rounded-full bg-online mr-2"></span>
                        <span class="text-sm text-gray-600">å¯¹æ–¹åœ¨çº¿</span>
                    </div>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="chat-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">ä»Šå¤©</span>
                        </div>
                        
                        <!-- å¯¹æ–¹æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <span>TA</span>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">äº²çˆ±çš„ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæƒ³ä½ äº†~ â¤ï¸</p>
                                <span class="text-xs text-gray-500 mt-1 block">10:30</span>
                            </div>
                        </div>
                        
                        <!-- æˆ‘çš„æ¶ˆæ¯ -->
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble-right bg-primary p-3 rounded-lg shadow-sm text-white max-w-xs md:max-w-md">
                                <p>æˆ‘ä¹Ÿæƒ³ä½ ï¼ä»Šå¤©å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä½†æ˜¯ä¸€æƒ³åˆ°ä½ å°±å¾ˆå¼€å¿ƒ ğŸ˜Š</p>
                                <span class="text-xs text-gray-200 mt-1 block">10:32</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white ml-2 flex-shrink-0">
                                <span>æˆ‘</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="chat-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥æ¶ˆæ¯...">
                    <button id="send-message" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- æ‹çˆ±é¡¾é—® -->
            <div id="advisor-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æ‹çˆ±é¡¾é—®</h3>
                    <span class="bg-secondary text-white text-xs px-2 py-1 rounded-full">AI</span>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="advisor-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">æ‹çˆ±é¡¾é—®éšæ—¶ä¸ºä½ æä¾›å»ºè®®</span>
                        </div>
                        
                        <!-- é¡¾é—®æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <i class="fa fa-heart"></i>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">å—¨ï¼æˆ‘æ˜¯ä½ ä»¬çš„æ‹çˆ±é¡¾é—®å°çˆ±ï½æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ä»¬çš„å—ï¼Ÿæ— è®ºæ˜¯çºªå¿µæ—¥ç­–åˆ’ã€åµæ¶å’Œå¥½è¿˜æ˜¯å¢è¿›æ„Ÿæƒ…çš„å°æŠ€å·§ï¼Œæˆ‘éƒ½å¯ä»¥ä¸ºä½ ä»¬æä¾›å»ºè®®å“¦ï¼</p>
                                <span class="text-xs text-gray-500 mt-1 block">åˆšåˆš</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="advisor-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥ä½ çš„é—®é¢˜...">
                    <button id="send-advisor" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>

                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">å¸¸è§é—®é¢˜ï¼š</p>
                    <div class="flex flex-wrap gap-2">
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">å¦‚ä½•åˆ¶é€ æµªæ¼«æƒŠå–œï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">åµæ¶åå¦‚ä½•å’Œå¥½ï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">çºªå¿µæ—¥ç¤¼ç‰©æ¨è</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ—¶é—´è®¡æ•°å™¨å¡ç‰‡ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8 transform transition-all duration-300 hover:shadow-xl">
            <div class="text-center">
                <h1 class="text-3xl font-bold text-primary mb-2">æˆ‘ä»¬ç›¸çˆ±å·²ç»</h1>
                <div class="flex justify-center space-x-6 mt-4">
                    <div class="text-center">
                        <div id="days" class="text-4xl font-bold text-secondary">0</div>
                        <div class="text-gray-500 mt-1">å¤©</div>
                    </div>
                    <div class="text-center">
                        <div id="months" class="text-4xl font-bold text-secondary">0</div>
                        <div class="text-gray-500 mt-1">æœˆ</div>
                    </div>
                    <div class="text-center">
                        <div id="years" class="text-4xl font-bold text-secondary">0</div>
                        <div class="text-gray-500 mt-1">å¹´</div>
                    </div>
                </div>
                <div class="mt-4">
                    <p id="love-date" class="text-gray-600">ä» <span class="font-medium text-primary">2023-01-01</span> å¼€å§‹</p>
                </div>
            </div>

            <!-- èŠå¤©åŠŸèƒ½ -->
            <div id="chat-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æˆ‘ä»¬çš„èŠå¤©</h3>
                    <div class="flex items-center">
                        <span id="partner-status" class="inline-block w-3 h-3 rounded-full bg-online mr-2"></span>
                        <span class="text-sm text-gray-600">å¯¹æ–¹åœ¨çº¿</span>
                    </div>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="chat-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">ä»Šå¤©</span>
                        </div>
                        
                        <!-- å¯¹æ–¹æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <span>TA</span>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">äº²çˆ±çš„ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæƒ³ä½ äº†~ â¤ï¸</p>
                                <span class="text-xs text-gray-500 mt-1 block">10:30</span>
                            </div>
                        </div>
                        
                        <!-- æˆ‘çš„æ¶ˆæ¯ -->
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble-right bg-primary p-3 rounded-lg shadow-sm text-white max-w-xs md:max-w-md">
                                <p>æˆ‘ä¹Ÿæƒ³ä½ ï¼ä»Šå¤©å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä½†æ˜¯ä¸€æƒ³åˆ°ä½ å°±å¾ˆå¼€å¿ƒ ğŸ˜Š</p>
                                <span class="text-xs text-gray-200 mt-1 block">10:32</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white ml-2 flex-shrink-0">
                                <span>æˆ‘</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="chat-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥æ¶ˆæ¯...">
                    <button id="send-message" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- æ‹çˆ±é¡¾é—® -->
            <div id="advisor-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æ‹çˆ±é¡¾é—®</h3>
                    <span class="bg-secondary text-white text-xs px-2 py-1 rounded-full">AI</span>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="advisor-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">æ‹çˆ±é¡¾é—®éšæ—¶ä¸ºä½ æä¾›å»ºè®®</span>
                        </div>
                        
                        <!-- é¡¾é—®æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <i class="fa fa-heart"></i>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">å—¨ï¼æˆ‘æ˜¯ä½ ä»¬çš„æ‹çˆ±é¡¾é—®å°çˆ±ï½æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ä»¬çš„å—ï¼Ÿæ— è®ºæ˜¯çºªå¿µæ—¥ç­–åˆ’ã€åµæ¶å’Œå¥½è¿˜æ˜¯å¢è¿›æ„Ÿæƒ…çš„å°æŠ€å·§ï¼Œæˆ‘éƒ½å¯ä»¥ä¸ºä½ ä»¬æä¾›å»ºè®®å“¦ï¼</p>
                                <span class="text-xs text-gray-500 mt-1 block">åˆšåˆš</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="advisor-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥ä½ çš„é—®é¢˜...">
                    <button id="send-advisor" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>

                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">å¸¸è§é—®é¢˜ï¼š</p>
                    <div class="flex flex-wrap gap-2">
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">å¦‚ä½•åˆ¶é€ æµªæ¼«æƒŠå–œï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">åµæ¶åå¦‚ä½•å’Œå¥½ï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">çºªå¿µæ—¥ç¤¼ç‰©æ¨è</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- è®¾ç½®æ‹çˆ±æ—¥æœŸæ¨¡æ€æ¡† -->
        <div id="date-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl p-6 w-full max-w-md transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
                <h3 class="text-xl font-bold text-primary mb-4 text-center">è®¾ç½®æˆ‘ä»¬çš„æ‹çˆ±å¼€å§‹æ—¥æœŸ</h3>
                <div class="mb-4">
                    <label for="start-date" class="block text-gray-700 mb-2">é€‰æ‹©æ—¥æœŸ</label>
                    <input type="date" id="start-date" class="w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancel-date" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">å–æ¶ˆ</button>
                    <button id="save-date" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-pink-600 transition-colors">ä¿å­˜</button>
                </div>
            </div>

            <!-- èŠå¤©åŠŸèƒ½ -->
            <div id="chat-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æˆ‘ä»¬çš„èŠå¤©</h3>
                    <div class="flex items-center">
                        <span id="partner-status" class="inline-block w-3 h-3 rounded-full bg-online mr-2"></span>
                        <span class="text-sm text-gray-600">å¯¹æ–¹åœ¨çº¿</span>
                    </div>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="chat-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">ä»Šå¤©</span>
                        </div>
                        
                        <!-- å¯¹æ–¹æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <span>TA</span>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">äº²çˆ±çš„ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæƒ³ä½ äº†~ â¤ï¸</p>
                                <span class="text-xs text-gray-500 mt-1 block">10:30</span>
                            </div>
                        </div>
                        
                        <!-- æˆ‘çš„æ¶ˆæ¯ -->
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble-right bg-primary p-3 rounded-lg shadow-sm text-white max-w-xs md:max-w-md">
                                <p>æˆ‘ä¹Ÿæƒ³ä½ ï¼ä»Šå¤©å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä½†æ˜¯ä¸€æƒ³åˆ°ä½ å°±å¾ˆå¼€å¿ƒ ğŸ˜Š</p>
                                <span class="text-xs text-gray-200 mt-1 block">10:32</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white ml-2 flex-shrink-0">
                                <span>æˆ‘</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="chat-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥æ¶ˆæ¯...">
                    <button id="send-message" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- æ‹çˆ±é¡¾é—® -->
            <div id="advisor-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æ‹çˆ±é¡¾é—®</h3>
                    <span class="bg-secondary text-white text-xs px-2 py-1 rounded-full">AI</span>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="advisor-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">æ‹çˆ±é¡¾é—®éšæ—¶ä¸ºä½ æä¾›å»ºè®®</span>
                        </div>
                        
                        <!-- é¡¾é—®æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <i class="fa fa-heart"></i>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">å—¨ï¼æˆ‘æ˜¯ä½ ä»¬çš„æ‹çˆ±é¡¾é—®å°çˆ±ï½æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ä»¬çš„å—ï¼Ÿæ— è®ºæ˜¯çºªå¿µæ—¥ç­–åˆ’ã€åµæ¶å’Œå¥½è¿˜æ˜¯å¢è¿›æ„Ÿæƒ…çš„å°æŠ€å·§ï¼Œæˆ‘éƒ½å¯ä»¥ä¸ºä½ ä»¬æä¾›å»ºè®®å“¦ï¼</p>
                                <span class="text-xs text-gray-500 mt-1 block">åˆšåˆš</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="advisor-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥ä½ çš„é—®é¢˜...">
                    <button id="send-advisor" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>

                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">å¸¸è§é—®é¢˜ï¼š</p>
                    <div class="flex flex-wrap gap-2">
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">å¦‚ä½•åˆ¶é€ æµªæ¼«æƒŠå–œï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">åµæ¶åå¦‚ä½•å’Œå¥½ï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">çºªå¿µæ—¥ç¤¼ç‰©æ¨è</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½é€‰é¡¹å¡ -->
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-8">
            <div class="flex border-b">
                <button class="tab-btn flex-1 py-4 text-center font-medium transition-colors duration-300 active bg-pink-50 text-primary border-b-2 border-primary" data-tab="dashboard">
                    <i class="fa fa-heart mr-2"></i>æ‹çˆ±æ¦‚è§ˆ
                </button>
                <button class="tab-btn flex-1 py-4 text-center font-medium transition-colors duration-300 text-gray-500 hover:bg-pink-50 hover:text-primary" data-tab="diary">
                    <i class="fa fa-book mr-2"></i>æ‹çˆ±æ—¥è®°
                </button>
                <button class="tab-btn flex-1 py-4 text-center font-medium transition-colors duration-300 text-gray-500 hover:bg-pink-50 hover:text-primary" data-tab="checkin">
                    <i class="fa fa-calendar-check-o mr-2"></i>æ¯æ—¥æ‰“å¡
                </button>
                <button class="tab-btn flex-1 py-4 text-center font-medium transition-colors duration-300 text-gray-500 hover:bg-pink-50 hover:text-primary" data-tab="chat">
                    <i class="fa fa-comments mr-2"></i>èŠå¤©
                </button>
                <button class="tab-btn flex-1 py-4 text-center font-medium transition-colors duration-300 text-gray-500 hover:bg-pink-50 hover:text-primary" data-tab="advisor">
                    <i class="fa fa-heartbeat mr-2"></i>æ‹çˆ±é¡¾é—®
                </button>
                <button class="tab-btn flex-1 py-4 text-center font-medium transition-colors duration-300 text-gray-500 hover:bg-pink-50 hover:text-primary" data-tab="memories">
                    <i class="fa fa-clock-o mr-2"></i>çºªå¿µæ—¥
                </button>
            </div>

            <!-- æ‹çˆ±æ¦‚è§ˆ -->
            <div id="dashboard-tab" class="tab-content p-6 block">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- æ‰“å¡ç»Ÿè®¡ -->
                    <div class="bg-pink-50 rounded-xl p-5">
                        <h3 class="text-lg font-semibold text-primary mb-3">æ‰“å¡ç»Ÿè®¡</h3>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600">è¿ç»­æ‰“å¡</p>
                                <p id="streak-count" class="text-3xl font-bold text-secondary">0</p>
                            </div>
                            <div>
                                <p class="text-gray-600">æ€»æ‰“å¡å¤©æ•°</p>
                                <p id="total-checkins" class="text-3xl font-bold text-secondary">0</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <canvas id="checkin-chart" height="150"></canvas>
                        </div>
                    </div>

                    <!-- å³å°†åˆ°æ¥çš„çºªå¿µæ—¥ -->
                    <div class="bg-purple-50 rounded-xl p-5">
                        <h3 class="text-lg font-semibold text-secondary mb-3">å³å°†åˆ°æ¥çš„çºªå¿µæ—¥</h3>
                        <div id="upcoming-anniversaries" class="space-y-3">
                            <div class="animate-pulse">
                                <div class="h-4 bg-purple-200 rounded w-3/4 mb-2"></div>
                                <div class="h-3 bg-purple-200 rounded w-1/2"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æœ€è¿‘çš„æ—¥è®°å’Œæ‰“å¡ -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold text-primary mb-3">æœ€è¿‘åŠ¨æ€</h3>
                    <div id="recent-activities" class="space-y-4">
                        <div class="animate-pulse">
                            <div class="h-4 bg-pink-200 rounded w-1/4 mb-2"></div>
                            <div class="h-3 bg-pink-200 rounded w-full mb-2"></div>
                            <div class="h-3 bg-pink-200 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ‹çˆ±æ—¥è®° -->
            <div id="diary-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æˆ‘çš„æ‹çˆ±æ—¥è®°</h3>
                    <button id="add-diary" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-plus mr-1"></i> å†™æ—¥è®°
                    </button>
                </div>

                <div id="diary-list" class="space-y-4">
                    <div class="animate-pulse">
                        <div class="h-4 bg-pink-200 rounded w-1/4 mb-2"></div>
                        <div class="h-3 bg-pink-200 rounded w-full mb-2"></div>
                        <div class="h-3 bg-pink-200 rounded w-5/6"></div>
                    </div>
                </div>
            </div>

            <!-- æ¯æ—¥æ‰“å¡ -->
            <div id="checkin-tab" class="tab-content p-6 hidden">
                <div class="text-center mb-6">
                    <h3 class="text-xl font-bold text-primary mb-2">ä»Šæ—¥æ‰“å¡</h3>
                    <p class="text-gray-600" id="today-date"></p>
                </div>

                <div class="bg-pink-50 rounded-xl p-6 mb-6">
                    <div id="checkin-status" class="text-center py-4">
                        <div id="not-checked-in" class="block">
                            <div class="text-6xl text-gray-300 mb-3">
                                <i class="fa fa-calendar-o"></i>
                            </div>
                            <p class="text-gray-600 mb-4">ä»Šå¤©è¿˜æ²¡æœ‰æ‰“å¡å“¦~</p>
                            <button id="checkin-btn" class="px-6 py-3 bg-primary text-white rounded-full hover:bg-pink-600 transition-colors text-lg font-medium">
                                ç«‹å³æ‰“å¡
                            </button>
                        </div>
                        <div id="checked-in" class="hidden">
                            <div class="text-6xl text-primary mb-3 heart-beat">
                                <i class="fa fa-heart"></i>
                            </div>
                            <p class="text-primary font-medium mb-2">ä»Šæ—¥å·²æ‰“å¡ â¤ï¸</p>
                            <p class="text-gray-500 text-sm">æ‰“å¡æ—¶é—´: <span id="checkin-time"></span></p>
                        </div>
                    </div>
                </div>

                <div class="mb-6">
                    <h4 class="text-lg font-semibold text-primary mb-3">æ‰“å¡å¿ƒæƒ…</h4>
                    <div class="grid grid-cols-4 gap-3">
                        <button class="mood-btn flex flex-col items-center p-3 border-2 border-transparent rounded-lg hover:border-pink-200 transition-colors" data-mood="å¼€å¿ƒ">
                            <div class="text-2xl mb-1">ğŸ˜Š</div>
                            <span class="text-sm">å¼€å¿ƒ</span>
                        </button>
                        <button class="mood-btn flex flex-col items-center p-3 border-2 border-transparent rounded-lg hover:border-pink-200 transition-colors" data-mood="ç”œèœœ">
                            <div class="text-2xl mb-1">ğŸ’•</div>
                            <span class="text-sm">ç”œèœœ</span>
                        </button>
                        <button class="mood-btn flex flex-col items-center p-3 border-2 border-transparent rounded-lg hover:border-pink-200 transition-colors" data-mood="æƒ³å¿µ">
                            <div class="text-2xl mb-1">ğŸ’­</div>
                            <span class="text-sm">æƒ³å¿µ</span>
                        </button>
                        <button class="mood-btn flex flex-col items-center p-3 border-2 border-transparent rounded-lg hover:border-pink-200 transition-colors" data-mood="å¹¸ç¦">
                            <div class="text-2xl mb-1">ğŸŒŸ</div>
                            <span class="text-sm">å¹¸ç¦</span>
                        </button>
                    </div>
                </div>

                <div>
                    <h4 class="text-lg font-semibold text-primary mb-3">æ‰“å¡è®°å½•</h4>
                    <div id="checkin-history" class="space-y-3">
                        <div class="animate-pulse">
                            <div class="h-4 bg-pink-200 rounded w-1/4 mb-2"></div>
                            <div class="h-3 bg-pink-200 rounded w-full mb-2"></div>
                            <div class="h-3 bg-pink-200 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çºªå¿µæ—¥ -->
            <div id="memories-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æˆ‘ä»¬çš„çºªå¿µæ—¥</h3>
                    <button id="add-memory" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-plus mr-1"></i> æ·»åŠ çºªå¿µæ—¥
                    </button>
                </div>

                <div id="memory-list" class="space-y-4">
                    <div class="animate-pulse">
                        <div class="h-4 bg-pink-200 rounded w-1/4 mb-2"></div>
                        <div class="h-3 bg-pink-200 rounded w-full mb-2"></div>
                        <div class="h-3 bg-pink-200 rounded w-5/6"></div>
                    </div>
                </div>
            </div>

            <!-- èŠå¤©åŠŸèƒ½ -->
            <div id="chat-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æˆ‘ä»¬çš„èŠå¤©</h3>
                    <div class="flex items-center">
                        <span id="partner-status" class="inline-block w-3 h-3 rounded-full bg-online mr-2"></span>
                        <span class="text-sm text-gray-600">å¯¹æ–¹åœ¨çº¿</span>
                    </div>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="chat-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">ä»Šå¤©</span>
                        </div>
                        
                        <!-- å¯¹æ–¹æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <span>TA</span>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">äº²çˆ±çš„ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæƒ³ä½ äº†~ â¤ï¸</p>
                                <span class="text-xs text-gray-500 mt-1 block">10:30</span>
                            </div>
                        </div>
                        
                        <!-- æˆ‘çš„æ¶ˆæ¯ -->
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble-right bg-primary p-3 rounded-lg shadow-sm text-white max-w-xs md:max-w-md">
                                <p>æˆ‘ä¹Ÿæƒ³ä½ ï¼ä»Šå¤©å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä½†æ˜¯ä¸€æƒ³åˆ°ä½ å°±å¾ˆå¼€å¿ƒ ğŸ˜Š</p>
                                <span class="text-xs text-gray-200 mt-1 block">10:32</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white ml-2 flex-shrink-0">
                                <span>æˆ‘</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="chat-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥æ¶ˆæ¯...">
                    <button id="send-message" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- æ‹çˆ±é¡¾é—® -->
            <div id="advisor-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æ‹çˆ±é¡¾é—®</h3>
                    <span class="bg-secondary text-white text-xs px-2 py-1 rounded-full">AI</span>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="advisor-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">æ‹çˆ±é¡¾é—®éšæ—¶ä¸ºä½ æä¾›å»ºè®®</span>
                        </div>
                        
                        <!-- é¡¾é—®æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <i class="fa fa-heart"></i>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">å—¨ï¼æˆ‘æ˜¯ä½ ä»¬çš„æ‹çˆ±é¡¾é—®å°çˆ±ï½æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ä»¬çš„å—ï¼Ÿæ— è®ºæ˜¯çºªå¿µæ—¥ç­–åˆ’ã€åµæ¶å’Œå¥½è¿˜æ˜¯å¢è¿›æ„Ÿæƒ…çš„å°æŠ€å·§ï¼Œæˆ‘éƒ½å¯ä»¥ä¸ºä½ ä»¬æä¾›å»ºè®®å“¦ï¼</p>
                                <span class="text-xs text-gray-500 mt-1 block">åˆšåˆš</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="advisor-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥ä½ çš„é—®é¢˜...">
                    <button id="send-advisor" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>

                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">å¸¸è§é—®é¢˜ï¼š</p>
                    <div class="flex flex-wrap gap-2">
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">å¦‚ä½•åˆ¶é€ æµªæ¼«æƒŠå–œï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">åµæ¶åå¦‚ä½•å’Œå¥½ï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">çºªå¿µæ—¥ç¤¼ç‰©æ¨è</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨è®¾ç½®æŒ‰é’® -->
        <div class="fixed bottom-6 right-6">
            <button id="settings-btn" class="w-14 h-14 bg-primary text-white rounded-full shadow-lg flex items-center justify-center hover:bg-pink-600 transition-all duration-300 transform hover:scale-110">
                <i class="fa fa-cog text-xl"></i>
            </button>
        </div>
    </div>

    <!-- æ·»åŠ æ—¥è®°æ¨¡æ€æ¡† -->
    <div id="diary-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-lg transform transition-all duration-300 scale-95 opacity-0" id="diary-modal-content">
            <h3 class="text-xl font-bold text-primary mb-4">å†™ä¸€ç¯‡æ—¥è®°</h3>
            <div class="mb-4">
                <label for="diary-title" class="block text-gray-700 mb-2">æ ‡é¢˜</label>
                <input type="text" id="diary-title" class="w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="ç»™ä»Šå¤©çš„æ—¥è®°èµ·ä¸ªæ ‡é¢˜">
            </div>
            <div class="mb-4">
                <label for="diary-content" class="block text-gray-700 mb-2">å†…å®¹</label>
                <textarea id="diary-content" rows="5" class="w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è®°å½•æˆ‘ä»¬ä»Šå¤©çš„ç‚¹æ»´..."></textarea>
            </div>
            <div class="flex justify-end space-x-3">
                <button id="cancel-diary" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">å–æ¶ˆ</button>
                <button id="save-diary" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-pink-600 transition-colors">ä¿å­˜</button>
            </div>

            <!-- èŠå¤©åŠŸèƒ½ -->
            <div id="chat-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æˆ‘ä»¬çš„èŠå¤©</h3>
                    <div class="flex items-center">
                        <span id="partner-status" class="inline-block w-3 h-3 rounded-full bg-online mr-2"></span>
                        <span class="text-sm text-gray-600">å¯¹æ–¹åœ¨çº¿</span>
                    </div>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="chat-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">ä»Šå¤©</span>
                        </div>
                        
                        <!-- å¯¹æ–¹æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <span>TA</span>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">äº²çˆ±çš„ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæƒ³ä½ äº†~ â¤ï¸</p>
                                <span class="text-xs text-gray-500 mt-1 block">10:30</span>
                            </div>
                        </div>
                        
                        <!-- æˆ‘çš„æ¶ˆæ¯ -->
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble-right bg-primary p-3 rounded-lg shadow-sm text-white max-w-xs md:max-w-md">
                                <p>æˆ‘ä¹Ÿæƒ³ä½ ï¼ä»Šå¤©å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä½†æ˜¯ä¸€æƒ³åˆ°ä½ å°±å¾ˆå¼€å¿ƒ ğŸ˜Š</p>
                                <span class="text-xs text-gray-200 mt-1 block">10:32</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white ml-2 flex-shrink-0">
                                <span>æˆ‘</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="chat-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥æ¶ˆæ¯...">
                    <button id="send-message" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- æ‹çˆ±é¡¾é—® -->
            <div id="advisor-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æ‹çˆ±é¡¾é—®</h3>
                    <span class="bg-secondary text-white text-xs px-2 py-1 rounded-full">AI</span>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="advisor-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">æ‹çˆ±é¡¾é—®éšæ—¶ä¸ºä½ æä¾›å»ºè®®</span>
                        </div>
                        
                        <!-- é¡¾é—®æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <i class="fa fa-heart"></i>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">å—¨ï¼æˆ‘æ˜¯ä½ ä»¬çš„æ‹çˆ±é¡¾é—®å°çˆ±ï½æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ä»¬çš„å—ï¼Ÿæ— è®ºæ˜¯çºªå¿µæ—¥ç­–åˆ’ã€åµæ¶å’Œå¥½è¿˜æ˜¯å¢è¿›æ„Ÿæƒ…çš„å°æŠ€å·§ï¼Œæˆ‘éƒ½å¯ä»¥ä¸ºä½ ä»¬æä¾›å»ºè®®å“¦ï¼</p>
                                <span class="text-xs text-gray-500 mt-1 block">åˆšåˆš</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="advisor-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥ä½ çš„é—®é¢˜...">
                    <button id="send-advisor" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>

                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">å¸¸è§é—®é¢˜ï¼š</p>
                    <div class="flex flex-wrap gap-2">
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">å¦‚ä½•åˆ¶é€ æµªæ¼«æƒŠå–œï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">åµæ¶åå¦‚ä½•å’Œå¥½ï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">çºªå¿µæ—¥ç¤¼ç‰©æ¨è</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ çºªå¿µæ—¥æ¨¡æ€æ¡† -->
    <div id="memory-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 w-full max-w-md transform transition-all duration-300 scale-95 opacity-0" id="memory-modal-content">
            <h3 class="text-xl font-bold text-primary mb-4">æ·»åŠ çºªå¿µæ—¥</h3>
            <div class="mb-4">
                <label for="memory-title" class="block text-gray-700 mb-2">çºªå¿µæ—¥åç§°</label>
                <input type="text" id="memory-title" class="w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="ä¾‹å¦‚ï¼šç¬¬ä¸€æ¬¡çº¦ä¼š">
            </div>
            <div class="mb-4">
                <label for="memory-date" class="block text-gray-700 mb-2">æ—¥æœŸ</label>
                <input type="date" id="memory-date" class="w-full px-4 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
            </div>
            <div class="flex justify-end space-x-3">
                <button id="cancel-memory" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">å–æ¶ˆ</button>
                <button id="save-memory" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-pink-600 transition-colors">ä¿å­˜</button>
            </div>

            <!-- èŠå¤©åŠŸèƒ½ -->
            <div id="chat-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æˆ‘ä»¬çš„èŠå¤©</h3>
                    <div class="flex items-center">
                        <span id="partner-status" class="inline-block w-3 h-3 rounded-full bg-online mr-2"></span>
                        <span class="text-sm text-gray-600">å¯¹æ–¹åœ¨çº¿</span>
                    </div>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="chat-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">ä»Šå¤©</span>
                        </div>
                        
                        <!-- å¯¹æ–¹æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <span>TA</span>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">äº²çˆ±çš„ï¼Œä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼Ÿæƒ³ä½ äº†~ â¤ï¸</p>
                                <span class="text-xs text-gray-500 mt-1 block">10:30</span>
                            </div>
                        </div>
                        
                        <!-- æˆ‘çš„æ¶ˆæ¯ -->
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble-right bg-primary p-3 rounded-lg shadow-sm text-white max-w-xs md:max-w-md">
                                <p>æˆ‘ä¹Ÿæƒ³ä½ ï¼ä»Šå¤©å·¥ä½œæœ‰ç‚¹å¿™ï¼Œä½†æ˜¯ä¸€æƒ³åˆ°ä½ å°±å¾ˆå¼€å¿ƒ ğŸ˜Š</p>
                                <span class="text-xs text-gray-200 mt-1 block">10:32</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white ml-2 flex-shrink-0">
                                <span>æˆ‘</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="chat-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥æ¶ˆæ¯...">
                    <button id="send-message" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- æ‹çˆ±é¡¾é—® -->
            <div id="advisor-tab" class="tab-content p-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold text-primary">æ‹çˆ±é¡¾é—®</h3>
                    <span class="bg-secondary text-white text-xs px-2 py-1 rounded-full">AI</span>
                </div>

                <div class="bg-pink-50 rounded-xl p-4 h-96 overflow-y-auto mb-4" id="advisor-messages">
                    <div class="flex flex-col space-y-4">
                        <!-- ç³»ç»Ÿæ¶ˆæ¯ -->
                        <div class="flex justify-center">
                            <span class="bg-white px-3 py-1 rounded-full text-xs text-gray-500">æ‹çˆ±é¡¾é—®éšæ—¶ä¸ºä½ æä¾›å»ºè®®</span>
                        </div>
                        
                        <!-- é¡¾é—®æ¶ˆæ¯ -->
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <i class="fa fa-heart"></i>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">å—¨ï¼æˆ‘æ˜¯ä½ ä»¬çš„æ‹çˆ±é¡¾é—®å°çˆ±ï½æœ‰ä»€ä¹ˆå¯ä»¥å¸®åˆ°ä½ ä»¬çš„å—ï¼Ÿæ— è®ºæ˜¯çºªå¿µæ—¥ç­–åˆ’ã€åµæ¶å’Œå¥½è¿˜æ˜¯å¢è¿›æ„Ÿæƒ…çš„å°æŠ€å·§ï¼Œæˆ‘éƒ½å¯ä»¥ä¸ºä½ ä»¬æä¾›å»ºè®®å“¦ï¼</p>
                                <span class="text-xs text-gray-500 mt-1 block">åˆšåˆš</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex items-center">
                    <input type="text" id="advisor-input" class="flex-1 px-4 py-2 border border-pink-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="è¾“å…¥ä½ çš„é—®é¢˜...">
                    <button id="send-advisor" class="bg-primary text-white px-4 py-2 rounded-r-lg hover:bg-pink-600 transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>

                <div class="mt-4">
                    <p class="text-sm text-gray-500 mb-2">å¸¸è§é—®é¢˜ï¼š</p>
                    <div class="flex flex-wrap gap-2">
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">å¦‚ä½•åˆ¶é€ æµªæ¼«æƒŠå–œï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">åµæ¶åå¦‚ä½•å’Œå¥½ï¼Ÿ</button>
                        <button class="quick-question bg-white px-3 py-1 rounded-full text-xs text-primary border border-pink-200 hover:bg-pink-50 transition-colors">çºªå¿µæ—¥ç¤¼ç‰©æ¨è</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        let loveData = {
            startDate: localStorage.getItem('loveStartDate') || '2023-01-01',
            checkins: JSON.parse(localStorage.getItem('loveCheckins')) || [],
            diaries: JSON.parse(localStorage.getItem('loveDiaries')) || [],
            memories: JSON.parse(localStorage.getItem('loveMemories')) || [],
            currentMood: localStorage.getItem('currentMood') || '',
            avatar: localStorage.getItem('loveAvatar') || '',
            background: localStorage.getItem('loveBackground') || '',
            messages: JSON.parse(localStorage.getItem('loveMessages')) || [],
            advisorMessages: JSON.parse(localStorage.getItem('loveAdvisorMessages')) || [],
            userId: localStorage.getItem('loveUserId') || Date.now().toString(),
            partnerId: localStorage.getItem('lovePartnerId') || '',
            partnerOnline: localStorage.getItem('lovePartnerOnline') === 'true' || false
        };

        // DOM åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ—¥æœŸ
            updateLoveTime();
            setInterval(updateLoveTime, 1000);
            
            // åˆå§‹åŒ–ä»Šæ—¥æ—¥æœŸ
            const today = new Date();
            document.getElementById('today-date').textContent = formatDate(today);
            
            // åˆå§‹åŒ–æ ‡ç­¾é¡µ
            initTabs();
            
            // åˆå§‹åŒ–æ¨¡æ€æ¡†
            initModals();
            
            // åˆå§‹åŒ–æ‰“å¡åŠŸèƒ½
            initCheckin();
            
            // åˆå§‹åŒ–æ—¥è®°åŠŸèƒ½
            initDiary();
            
            // åˆå§‹åŒ–çºªå¿µæ—¥åŠŸèƒ½
            initMemories();
            
            // åˆå§‹åŒ–å›¾è¡¨
            initCharts();
            
            // åˆå§‹åŒ–å¤´åƒä¸Šä¼ 
            initAvatarUpload();
            
            // åˆå§‹åŒ–èƒŒæ™¯ä¸Šä¼ 
            initBackgroundUpload();
            
            // åˆå§‹åŒ–èŠå¤©åŠŸèƒ½
            initChat();
            
            // åˆå§‹åŒ–æ‹çˆ±é¡¾é—®
            initAdvisor();
            
            // åŠ è½½æ•°æ®
            loadData();
            
            // åŠ è½½ç”¨æˆ·æ•°æ®
            loadUserData();
            
            // æ¨¡æ‹Ÿå¯¹æ–¹åœ¨çº¿çŠ¶æ€
            simulatePartnerOnline();
        });

        // æ›´æ–°æ‹çˆ±æ—¶é—´
        function updateLoveTime() {
            const startDate = new Date(loveData.startDate);
            const now = new Date();
            
            const diffTime = Math.abs(now - startDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const diffMonths = Math.floor(diffDays / 30.44);
            const diffYears = Math.floor(diffMonths / 12);
            
            document.getElementById('days').textContent = diffDays;
            document.getElementById('months').textContent = diffMonths;
            document.getElementById('years').textContent = diffYears;
            
            document.getElementById('love-date').innerHTML = `ä» <span class="font-medium text-primary">${formatDate(startDate)}</span> å¼€å§‹`;
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // åˆå§‹åŒ–æ ‡ç­¾é¡µ
        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    tabBtns.forEach(b => {
                        b.classList.remove('active', 'bg-pink-50', 'text-primary', 'border-b-2', 'border-primary');
                        b.classList.add('text-gray-500', 'hover:bg-pink-50', 'hover:text-primary');
                    });
                    
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                    btn.classList.add('active', 'bg-pink-50', 'text-primary', 'border-b-2', 'border-primary');
                    btn.classList.remove('text-gray-500', 'hover:bg-pink-50', 'hover:text-primary');
                    
                    // æ˜¾ç¤ºå¯¹åº”å†…å®¹
                    const tabId = btn.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.remove('hidden');
                });
            });
        }

        // åˆå§‹åŒ–æ¨¡æ€æ¡†
        function initModals() {
            // è®¾ç½®æ‹çˆ±æ—¥æœŸæ¨¡æ€æ¡†
            const dateModal = document.getElementById('date-modal');
            const modalContent = document.getElementById('modal-content');
            const startDateInput = document.getElementById('start-date');
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            startDateInput.value = loveData.startDate;
            
            // è®¾ç½®æŒ‰é’®
            document.getElementById('settings-btn').addEventListener('click', () => {
                dateModal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });
            
            // å–æ¶ˆæŒ‰é’®
            document.getElementById('cancel-date').addEventListener('click', () => {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    dateModal.classList.add('hidden');
                }, 300);
            });
            
            // ä¿å­˜æŒ‰é’®
            document.getElementById('save-date').addEventListener('click', () => {
                if (startDateInput.value) {
                    loveData.startDate = startDateInput.value;
                    localStorage.setItem('loveStartDate', loveData.startDate);
                    updateLoveTime();
                    
                    modalContent.classList.remove('scale-100', 'opacity-100');
                    modalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        dateModal.classList.add('hidden');
                    }, 300);
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showToast('æ‹çˆ±æ—¥æœŸè®¾ç½®æˆåŠŸï¼');
                }
            });
            
            // æ—¥è®°æ¨¡æ€æ¡†
            const diaryModal = document.getElementById('diary-modal');
            const diaryModalContent = document.getElementById('diary-modal-content');
            
            document.getElementById('add-diary').addEventListener('click', () => {
                diaryModal.classList.remove('hidden');
                setTimeout(() => {
                    diaryModalContent.classList.remove('scale-95', 'opacity-0');
                    diaryModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });
            
            document.getElementById('cancel-diary').addEventListener('click', () => {
                diaryModalContent.classList.remove('scale-100', 'opacity-100');
                diaryModalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    diaryModal.classList.add('hidden');
                    clearDiaryForm();
                }, 300);
            });
            
            // çºªå¿µæ—¥æ¨¡æ€æ¡†
            const memoryModal = document.getElementById('memory-modal');
            const memoryModalContent = document.getElementById('memory-modal-content');
            
            document.getElementById('add-memory').addEventListener('click', () => {
                memoryModal.classList.remove('hidden');
                setTimeout(() => {
                    memoryModalContent.classList.remove('scale-95', 'opacity-0');
                    memoryModalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            });
            
            document.getElementById('cancel-memory').addEventListener('click', () => {
                memoryModalContent.classList.remove('scale-100', 'opacity-100');
                memoryModalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    memoryModal.classList.add('hidden');
                    clearMemoryForm();
                }, 300);
            });
        }

        // åˆå§‹åŒ–æ‰“å¡åŠŸèƒ½
        function initCheckin() {
            const checkinBtn = document.getElementById('checkin-btn');
            const notCheckedIn = document.getElementById('not-checked-in');
            const checkedIn = document.getElementById('checked-in');
            const checkinTime = document.getElementById('checkin-time');
            const moodBtns = document.querySelectorAll('.mood-btn');
            
            // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²æ‰“å¡
            checkTodayCheckin();
            
            // æ‰“å¡æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            checkinBtn.addEventListener('click', () => {
                const today = new Date();
                const todayStr = formatDate(today);
                
                // æ·»åŠ æ‰“å¡è®°å½•
                loveData.checkins.push({
                    date: todayStr,
                    time: today.toLocaleTimeString(),
                    mood: loveData.currentMood || 'å¼€å¿ƒ'
                });
                
                // ä¿å­˜æ•°æ®
                localStorage.setItem('loveCheckins', JSON.stringify(loveData.checkins));
                
                // æ›´æ–°UI
                notCheckedIn.classList.add('hidden');
                checkedIn.classList.remove('hidden');
                checkinTime.textContent = today.toLocaleTimeString();
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast('æ‰“å¡æˆåŠŸï¼çˆ±ä½ æ¯ä¸€å¤© â¤ï¸');
                
                // æ›´æ–°æ‰“å¡å†å²
                renderCheckinHistory();
                
                // æ›´æ–°ç»Ÿè®¡
                updateCheckinStats();
                
                // æ›´æ–°å›¾è¡¨
                updateCheckinChart();
            });
            
            // å¿ƒæƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            moodBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰é€‰ä¸­çŠ¶æ€
                    moodBtns.forEach(b => {
                        b.classList.remove('border-primary', 'bg-pink-50');
                        b.classList.add('border-transparent');
                    });
                    
                    // æ·»åŠ å½“å‰é€‰ä¸­çŠ¶æ€
                    btn.classList.add('border-primary', 'bg-pink-50');
                    btn.classList.remove('border-transparent');
                    
                    // ä¿å­˜å¿ƒæƒ…
                    loveData.currentMood = btn.getAttribute('data-mood');
                    localStorage.setItem('currentMood', loveData.currentMood);
                });
            });
            
            // å¦‚æœæœ‰ä¿å­˜çš„å¿ƒæƒ…ï¼Œé€‰ä¸­å¯¹åº”æŒ‰é’®
            if (loveData.currentMood) {
                const selectedMoodBtn = document.querySelector(`[data-mood="${loveData.currentMood}"]`);
                if (selectedMoodBtn) {
                    selectedMoodBtn.classList.add('border-primary', 'bg-pink-50');
                    selectedMoodBtn.classList.remove('border-transparent');
                }
            }
        }

        // æ£€æŸ¥ä»Šæ—¥æ˜¯å¦å·²æ‰“å¡
        function checkTodayCheckin() {
            const today = formatDate(new Date());
            const todayCheckin = loveData.checkins.find(checkin => checkin.date === today);
            
            const notCheckedIn = document.getElementById('not-checked-in');
            const checkedIn = document.getElementById('checked-in');
            const checkinTime = document.getElementById('checkin-time');
            
            if (todayCheckin) {
                notCheckedIn.classList.add('hidden');
                checkedIn.classList.remove('hidden');
                checkinTime.textContent = todayCheckin.time;
            } else {
                notCheckedIn.classList.remove('hidden');
                checkedIn.classList.add('hidden');
            }
        }

        // æ¸²æŸ“æ‰“å¡å†å²
        function renderCheckinHistory() {
            const checkinHistory = document.getElementById('checkin-history');
            
            // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰
            const sortedCheckins = [...loveData.checkins].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            // é™åˆ¶æ˜¾ç¤ºæœ€è¿‘10æ¡
            const recentCheckins = sortedCheckins.slice(0, 10);
            
            if (recentCheckins.length === 0) {
                checkinHistory.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <p>è¿˜æ²¡æœ‰æ‰“å¡è®°å½•ï¼Œä»Šå¤©å°±å¼€å§‹å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            checkinHistory.innerHTML = recentCheckins.map(checkin => `
                <div class="bg-white rounded-lg p-3 shadow-sm border border-pink-100">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="text-xl mr-2">${getMoodEmoji(checkin.mood)}</div>
                            <div>
                                <p class="font-medium text-gray-800">${checkin.mood}</p>
                                <p class="text-sm text-gray-500">${checkin.date} ${checkin.time}</p>
                            </div>
                        </div>
                        <div class="text-primary">
                            <i class="fa fa-heart"></i>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // è·å–å¿ƒæƒ…å¯¹åº”çš„è¡¨æƒ…
        function getMoodEmoji(mood) {
            const moodMap = {
                'å¼€å¿ƒ': 'ğŸ˜Š',
                'ç”œèœœ': 'ğŸ’•',
                'æƒ³å¿µ': 'ğŸ’­',
                'å¹¸ç¦': 'ğŸŒŸ'
            };
            return moodMap[mood] || 'ğŸ˜Š';
        }

        // æ›´æ–°æ‰“å¡ç»Ÿè®¡
        function updateCheckinStats() {
            // è®¡ç®—æ€»æ‰“å¡å¤©æ•°
            const totalCheckins = loveData.checkins.length;
            document.getElementById('total-checkins').textContent = totalCheckins;
            
            // è®¡ç®—è¿ç»­æ‰“å¡å¤©æ•°
            const sortedCheckins = [...loveData.checkins].sort((a, b) => 
                new Date(b.date) - new Date(a.date)
            );
            
            let streak = 0;
            const today = new Date();
            
            for (let i = 0; i < sortedCheckins.length; i++) {
                const checkinDate = new Date(sortedCheckins[i].date);
                const expectedDate = new Date(today);
                expectedDate.setDate(today.getDate() - i);
                
                if (formatDate(checkinDate) === formatDate(expectedDate)) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('streak-count').textContent = streak;
        }

        // åˆå§‹åŒ–æ—¥è®°åŠŸèƒ½
        function initDiary() {
            const saveDiaryBtn = document.getElementById('save-diary');
            const diaryModal = document.getElementById('diary-modal');
            const diaryModalContent = document.getElementById('diary-modal-content');
            
            saveDiaryBtn.addEventListener('click', () => {
                const title = document.getElementById('diary-title').value;
                const content = document.getElementById('diary-content').value;
                
                if (title && content) {
                    const today = new Date();
                    
                    // æ·»åŠ æ—¥è®°
                    loveData.diaries.push({
                        id: Date.now(),
                        title,
                        content,
                        date: formatDate(today),
                        time: today.toLocaleTimeString()
                    });
                    
                    // ä¿å­˜æ•°æ®
                    localStorage.setItem('loveDiaries', JSON.stringify(loveData.diaries));
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    diaryModalContent.classList.remove('scale-100', 'opacity-100');
                    diaryModalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        diaryModal.classList.add('hidden');
                        clearDiaryForm();
                    }, 300);
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showToast('æ—¥è®°ä¿å­˜æˆåŠŸï¼');
                    
                    // æ›´æ–°æ—¥è®°åˆ—è¡¨
                    renderDiaryList();
                    
                    // æ›´æ–°æœ€è¿‘åŠ¨æ€
                    renderRecentActivities();
                } else {
                    showToast('è¯·å¡«å†™æ ‡é¢˜å’Œå†…å®¹');
                }
            });
        }

        // æ¸…ç©ºæ—¥è®°è¡¨å•
        function clearDiaryForm() {
            document.getElementById('diary-title').value = '';
            document.getElementById('diary-content').value = '';
        }

        // æ¸²æŸ“æ—¥è®°åˆ—è¡¨
        function renderDiaryList() {
            const diaryList = document.getElementById('diary-list');
            
            // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰
            const sortedDiaries = [...loveData.diaries].sort((a, b) => b.id - a.id);
            
            if (sortedDiaries.length === 0) {
                diaryList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fa fa-book text-4xl mb-3"></i>
                        <p>è¿˜æ²¡æœ‰æ—¥è®°ï¼Œå†™ä¸‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ•…äº‹å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            diaryList.innerHTML = sortedDiaries.map(diary => `
                <div class="bg-white rounded-lg p-4 shadow-sm border border-pink-100 transform transition-all duration-300 hover:shadow-md">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="text-lg font-semibold text-primary">${diary.title}</h4>
                        <span class="text-sm text-gray-500">${diary.date}</span>
                    </div>
                    <p class="text-gray-700 mb-3">${diary.content}</p>
                    <div class="flex justify-between items-center">
                        <span class="text-xs text-gray-500">${diary.time}</span>
                        <button class="delete-diary text-gray-400 hover:text-red-500 transition-colors" data-id="${diary.id}">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            // æ·»åŠ åˆ é™¤æ—¥è®°äº‹ä»¶
            document.querySelectorAll('.delete-diary').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const diaryId = parseInt(e.currentTarget.getAttribute('data-id'));
                    deleteDiary(diaryId);
                });
            });
        }

        // åˆ é™¤æ—¥è®°
        function deleteDiary(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ')) {
                loveData.diaries = loveData.diaries.filter(diary => diary.id !== id);
                localStorage.setItem('loveDiaries', JSON.stringify(loveData.diaries));
                
                // æ›´æ–°æ—¥è®°åˆ—è¡¨
                renderDiaryList();
                
                // æ›´æ–°æœ€è¿‘åŠ¨æ€
                renderRecentActivities();
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast('æ—¥è®°å·²åˆ é™¤');
            }
        }

        // åˆå§‹åŒ–çºªå¿µæ—¥åŠŸèƒ½
        function initMemories() {
            const saveMemoryBtn = document.getElementById('save-memory');
            const memoryModal = document.getElementById('memory-modal');
            const memoryModalContent = document.getElementById('memory-modal-content');
            
            saveMemoryBtn.addEventListener('click', () => {
                const title = document.getElementById('memory-title').value;
                const date = document.getElementById('memory-date').value;
                
                if (title && date) {
                    // æ·»åŠ çºªå¿µæ—¥
                    loveData.memories.push({
                        id: Date.now(),
                        title,
                        date
                    });
                    
                    // ä¿å­˜æ•°æ®
                    localStorage.setItem('loveMemories', JSON.stringify(loveData.memories));
                    
                    // å…³é—­æ¨¡æ€æ¡†
                    memoryModalContent.classList.remove('scale-100', 'opacity-100');
                    memoryModalContent.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        memoryModal.classList.add('hidden');
                        clearMemoryForm();
                    }, 300);
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    showToast('çºªå¿µæ—¥æ·»åŠ æˆåŠŸï¼');
                    
                    // æ›´æ–°çºªå¿µæ—¥åˆ—è¡¨
                    renderMemoryList();
                    
                    // æ›´æ–°å³å°†åˆ°æ¥çš„çºªå¿µæ—¥
                    renderUpcomingAnniversaries();
                    
                    // æ›´æ–°æœ€è¿‘åŠ¨æ€
                    renderRecentActivities();
                } else {
                    showToast('è¯·å¡«å†™çºªå¿µæ—¥åç§°å’Œæ—¥æœŸ');
                }
            });
        }

        // æ¸…ç©ºçºªå¿µæ—¥è¡¨å•
        function clearMemoryForm() {
            document.getElementById('memory-title').value = '';
            document.getElementById('memory-date').value = '';
        }

        // æ¸²æŸ“çºªå¿µæ—¥åˆ—è¡¨
        function renderMemoryList() {
            const memoryList = document.getElementById('memory-list');
            
            // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€è¿‘çš„åœ¨å‰
            const sortedMemories = [...loveData.memories].sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                
                // è®¾ç½®ä»Šå¹´çš„æ—¥æœŸè¿›è¡Œæ¯”è¾ƒ
                const today = new Date();
                dateA.setFullYear(today.getFullYear());
                dateB.setFullYear(today.getFullYear());
                
                // å¦‚æœå·²ç»è¿‡äº†ä»Šå¹´çš„æ—¥æœŸï¼Œè®¾ç½®ä¸ºæ˜å¹´
                if (dateA < today) {
                    dateA.setFullYear(today.getFullYear() + 1);
                }
                if (dateB < today) {
                    dateB.setFullYear(today.getFullYear() + 1);
                }
                
                return dateA - dateB;
            });
            
            if (sortedMemories.length === 0) {
                memoryList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fa fa-star text-4xl mb-3"></i>
                        <p>è¿˜æ²¡æœ‰æ·»åŠ çºªå¿µæ—¥ï¼Œè®°å½•æˆ‘ä»¬çš„ç‰¹åˆ«æ—¥å­å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            memoryList.innerHTML = sortedMemories.map(memory => {
                const memoryDate = new Date(memory.date);
                const today = new Date();
                
                // è®¡ç®—è·ç¦»ä»Šå¹´çºªå¿µæ—¥çš„å¤©æ•°
                const thisYearMemory = new Date(memoryDate);
                thisYearMemory.setFullYear(today.getFullYear());
                
                let daysLeft;
                if (thisYearMemory >= today) {
                    daysLeft = Math.ceil((thisYearMemory - today) / (1000 * 60 * 60 * 24));
                } else {
                    // å¦‚æœä»Šå¹´çš„çºªå¿µæ—¥å·²ç»è¿‡äº†ï¼Œè®¡ç®—åˆ°æ˜å¹´çš„å¤©æ•°
                    const nextYearMemory = new Date(memoryDate);
                    nextYearMemory.setFullYear(today.getFullYear() + 1);
                    daysLeft = Math.ceil((nextYearMemory - today) / (1000 * 60 * 60 * 24));
                }
                
                const isToday = daysLeft === 0;
                const isUpcoming = daysLeft <= 7;
                
                return `
                    <div class="bg-white rounded-lg p-4 shadow-sm border ${isToday ? 'border-primary bg-pink-50' : 'border-pink-100'} transform transition-all duration-300 hover:shadow-md">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-lg font-semibold ${isToday ? 'text-primary' : 'text-gray-800'}">${memory.title}</h4>
                            <span class="text-sm ${isToday ? 'text-primary font-medium' : 'text-gray-500'}">${formatDate(memoryDate)}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <div class="${isToday ? 'text-primary font-medium' : 'text-gray-600'}">
                                ${isToday ? 'ä»Šå¤©æ˜¯çºªå¿µæ—¥ï¼ğŸ‰' : isUpcoming ? `${daysLeft} å¤©å` : `${daysLeft} å¤©å`}
                            </div>
                            <button class="delete-memory text-gray-400 hover:text-red-500 transition-colors" data-id="${memory.id}">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // æ·»åŠ åˆ é™¤çºªå¿µæ—¥äº‹ä»¶
            document.querySelectorAll('.delete-memory').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const memoryId = parseInt(e.currentTarget.getAttribute('data-id'));
                    deleteMemory(memoryId);
                });
            });
        }

        // åˆ é™¤çºªå¿µæ—¥
        function deleteMemory(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªçºªå¿µæ—¥å—ï¼Ÿ')) {
                loveData.memories = loveData.memories.filter(memory => memory.id !== id);
                localStorage.setItem('loveMemories', JSON.stringify(loveData.memories));
                
                // æ›´æ–°çºªå¿µæ—¥åˆ—è¡¨
                renderMemoryList();
                
                // æ›´æ–°å³å°†åˆ°æ¥çš„çºªå¿µæ—¥
                renderUpcomingAnniversaries();
                
                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showToast('çºªå¿µæ—¥å·²åˆ é™¤');
            }
        }

        // æ¸²æŸ“å³å°†åˆ°æ¥çš„çºªå¿µæ—¥
        function renderUpcomingAnniversaries() {
            const upcomingContainer = document.getElementById('upcoming-anniversaries');
            
            if (loveData.memories.length === 0) {
                upcomingContainer.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <p>è¿˜æ²¡æœ‰æ·»åŠ çºªå¿µæ—¥</p>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€è¿‘çš„åœ¨å‰
            const sortedMemories = [...loveData.memories].sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                
                // è®¾ç½®ä»Šå¹´çš„æ—¥æœŸè¿›è¡Œæ¯”è¾ƒ
                const today = new Date();
                dateA.setFullYear(today.getFullYear());
                dateB.setFullYear(today.getFullYear());
                
                // å¦‚æœå·²ç»è¿‡äº†ä»Šå¹´çš„æ—¥æœŸï¼Œè®¾ç½®ä¸ºæ˜å¹´
                if (dateA < today) {
                    dateA.setFullYear(today.getFullYear() + 1);
                }
                if (dateB < today) {
                    dateB.setFullYear(today.getFullYear() + 1);
                }
                
                return dateA - dateB;
            });
            
            // åªæ˜¾ç¤ºå‰3ä¸ªå³å°†åˆ°æ¥çš„çºªå¿µæ—¥
            const upcomingMemories = sortedMemories.slice(0, 3);
            
            upcomingContainer.innerHTML = upcomingMemories.map(memory => {
                const memoryDate = new Date(memory.date);
                const today = new Date();
                
                // è®¡ç®—è·ç¦»ä»Šå¹´çºªå¿µæ—¥çš„å¤©æ•°
                const thisYearMemory = new Date(memoryDate);
                thisYearMemory.setFullYear(today.getFullYear());
                
                let daysLeft;
                if (thisYearMemory >= today) {
                    daysLeft = Math.ceil((thisYearMemory - today) / (1000 * 60 * 60 * 24));
                } else {
                    // å¦‚æœä»Šå¹´çš„çºªå¿µæ—¥å·²ç»è¿‡äº†ï¼Œè®¡ç®—åˆ°æ˜å¹´çš„å¤©æ•°
                    const nextYearMemory = new Date(memoryDate);
                    nextYearMemory.setFullYear(today.getFullYear() + 1);
                    daysLeft = Math.ceil((nextYearMemory - today) / (1000 * 60 * 60 * 24));
                }
                
                const isToday = daysLeft === 0;
                const isUpcoming = daysLeft <= 7;
                
                return `
                    <div class="flex justify-between items-center p-3 rounded-lg ${isToday ? 'bg-pink-100' : 'bg-white'}">
                        <div>
                            <p class="font-medium ${isToday ? 'text-primary' : 'text-gray-800'}">${memory.title}</p>
                            <p class="text-sm text-gray-500">${formatDate(memoryDate)}</p>
                        </div>
                        <div class="${isToday ? 'text-primary font-medium' : 'text-gray-600'}">
                            ${isToday ? 'ä»Šå¤© ğŸ‰' : `${daysLeft} å¤©å`}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            const ctx = document.getElementById('checkin-chart').getContext('2d');
            
            // å‡†å¤‡æœ€è¿‘7å¤©çš„æ•°æ®
            const labels = [];
            const data = [];
            
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                
                const dateStr = formatDate(date);
                labels.push(date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }));
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ‰“å¡è®°å½•
                const hasCheckin = loveData.checkins.some(checkin => checkin.date === dateStr);
                data.push(hasCheckin ? 1 : 0);
            }
            
            window.checkinChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'æ‰“å¡è®°å½•',
                        data: data,
                        backgroundColor: data.map(value => value ? '#ff6b8b' : '#e2e8f0'),
                        borderColor: data.map(value => value ? '#ff6b8b' : '#e2e8f0'),
                        borderWidth: 1,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw === 1 ? 'å·²æ‰“å¡' : 'æœªæ‰“å¡';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 1,
                            ticks: {
                                display: false
                            },
                            grid: {
                                display: false
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // æ›´æ–°æ‰“å¡å›¾è¡¨
        function updateCheckinChart() {
            // å‡†å¤‡æœ€è¿‘7å¤©çš„æ•°æ®
            const labels = [];
            const data = [];
            
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                
                const dateStr = formatDate(date);
                labels.push(date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' }));
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ‰“å¡è®°å½•
                const hasCheckin = loveData.checkins.some(checkin => checkin.date === dateStr);
                data.push(hasCheckin ? 1 : 0);
            }
            
            window.checkinChart.data.labels = labels;
            window.checkinChart.data.datasets[0].data = data;
            window.checkinChart.data.datasets[0].backgroundColor = data.map(value => value ? '#ff6b8b' : '#e2e8f0');
            window.checkinChart.data.datasets[0].borderColor = data.map(value => value ? '#ff6b8b' : '#e2e8f0');
            
            window.checkinChart.update();
        }

        // æ¸²æŸ“æœ€è¿‘åŠ¨æ€
        function renderRecentActivities() {
            const activitiesContainer = document.getElementById('recent-activities');
            
            // åˆå¹¶æ‰€æœ‰æ´»åŠ¨
            const activities = [
                ...loveData.diaries.map(diary => ({
                    type: 'diary',
                    id: diary.id,
                    title: diary.title,
                    date: diary.date,
                    time: diary.time
                })),
                ...loveData.memories.map(memory => ({
                    type: 'memory',
                    id: memory.id,
                    title: memory.title,
                    date: memory.date
                }))
            ];
            
            // æŒ‰æ—¥æœŸæ’åºï¼Œæœ€æ–°çš„åœ¨å‰
            activities.sort((a, b) => {
                const dateA = new Date(a.date + ' ' + (a.time || '23:59'));
                const dateB = new Date(b.date + ' ' + (b.time || '23:59'));
                return dateB - dateA;
            });
            
            // é™åˆ¶æ˜¾ç¤ºæœ€è¿‘5æ¡
            const recentActivities = activities.slice(0, 5);
            
            if (recentActivities.length === 0) {
                activitiesContainer.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <p>è¿˜æ²¡æœ‰åŠ¨æ€ï¼Œå¼€å§‹è®°å½•æˆ‘ä»¬çš„æ•…äº‹å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            activitiesContainer.innerHTML = recentActivities.map(activity => {
                const today = new Date();
                const activityDate = new Date(activity.date);
                const isToday = formatDate(activityDate) === formatDate(today);
                const isYesterday = formatDate(activityDate) === formatDate(new Date(today.setDate(today.getDate() - 1)));
                
                let dateText;
                if (isToday) {
                    dateText = 'ä»Šå¤©';
                } else if (isYesterday) {
                    dateText = 'æ˜¨å¤©';
                } else {
                    dateText = formatDate(activityDate);
                }
                
                if (activity.time) {
                    dateText += ' ' + activity.time;
                }
                
                return `
                    <div class="flex items-start p-3 bg-white rounded-lg shadow-sm border border-pink-100">
                        <div class="text-2xl mr-3 ${activity.type === 'diary' ? 'text-primary' : 'text-secondary'}">
                            ${activity.type === 'diary' ? 'ğŸ“' : 'â­'}
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <p class="font-medium text-gray-800">${activity.type === 'diary' ? 'å†™äº†æ—¥è®°ï¼š' : 'æ·»åŠ äº†çºªå¿µæ—¥ï¼š'}${activity.title}</p>
                                <span class="text-sm text-gray-500">${dateText}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // åŠ è½½æ•°æ®
        function loadData() {
            // æ¸²æŸ“æ—¥è®°åˆ—è¡¨
            renderDiaryList();
            
            // æ¸²æŸ“çºªå¿µæ—¥åˆ—è¡¨
            renderMemoryList();
            
            // æ¸²æŸ“æ‰“å¡å†å²
            renderCheckinHistory();
            
            // æ›´æ–°æ‰“å¡ç»Ÿè®¡
            updateCheckinStats();
            
            // æ¸²æŸ“å³å°†åˆ°æ¥çš„çºªå¿µæ—¥
            renderUpcomingAnniversaries();
            
            // æ¸²æŸ“æœ€è¿‘åŠ¨æ€
            renderRecentActivities();
        }

        // åˆå§‹åŒ–å¤´åƒä¸Šä¼ 
        function initAvatarUpload() {
            const avatarUpload = document.getElementById('avatar-upload');
            const coupleAvatar = document.getElementById('couple-avatar');
            
            avatarUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageUrl = e.target.result;
                        coupleAvatar.src = imageUrl;
                        loveData.avatar = imageUrl;
                        localStorage.setItem('loveAvatar', imageUrl);
                        showToast('å¤´åƒä¸Šä¼ æˆåŠŸï¼');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // åˆå§‹åŒ–èƒŒæ™¯ä¸Šä¼ 
        function initBackgroundUpload() {
            const backgroundUpload = document.getElementById('background-upload');
            const backgroundImage = document.getElementById('background-image');
            
            backgroundUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageUrl = e.target.result;
                        backgroundImage.style.backgroundImage = `url(${imageUrl})`;
                        backgroundImage.style.opacity = '0.3';
                        loveData.background = imageUrl;
                        localStorage.setItem('loveBackground', imageUrl);
                        showToast('èƒŒæ™¯è®¾ç½®æˆåŠŸï¼');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // åˆå§‹åŒ–èŠå¤©åŠŸèƒ½
        function initChat() {
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-message');
            const chatMessages = document.getElementById('chat-messages');
            
            // å‘é€æ¶ˆæ¯
            function sendMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    const newMessage = {
                        id: Date.now(),
                        sender: 'me',
                        content: message,
                        timestamp: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
                    };
                    
                    loveData.messages.push(newMessage);
                    localStorage.setItem('loveMessages', JSON.stringify(loveData.messages));
                    
                    renderChatMessages();
                    chatInput.value = '';
                    
                    // æ¨¡æ‹Ÿå¯¹æ–¹å›å¤
                    setTimeout(simulatePartnerReply, 1000 + Math.random() * 2000);
                }
            }
            
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // æ¸²æŸ“èŠå¤©æ¶ˆæ¯
            renderChatMessages();
        }

        // æ¸²æŸ“èŠå¤©æ¶ˆæ¯
        function renderChatMessages() {
            const chatMessages = document.getElementById('chat-messages');
            
            if (loveData.messages.length === 0) {
                chatMessages.innerHTML = `
                    <div class="flex justify-center items-center h-full">
                        <div class="text-center text-gray-500">
                            <i class="fa fa-heart text-4xl mb-3"></i>
                            <p>å¼€å§‹ä½ ä»¬çš„ç”œèœœå¯¹è¯å§ï¼</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            chatMessages.innerHTML = loveData.messages.map(msg => {
                if (msg.sender === 'me') {
                    return `
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble-right bg-primary p-3 rounded-lg shadow-sm text-white max-w-xs md:max-w-md">
                                <p>${msg.content}</p>
                                <span class="text-xs text-gray-200 mt-1 block">${msg.timestamp}</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white ml-2 flex-shrink-0">
                                <span>æˆ‘</span>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <span>TA</span>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800">${msg.content}</p>
                                <span class="text-xs text-gray-500 mt-1 block">${msg.timestamp}</span>
                            </div>
                        </div>
                    `;
                }
            }).join('');
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // æ¨¡æ‹Ÿå¯¹æ–¹å›å¤
        function simulatePartnerReply() {
            const replies = [
                'äº²çˆ±çš„ï¼Œæˆ‘ä¹Ÿå¾ˆæƒ³ä½ ï¼â¤ï¸',
                'ä»Šå¤©æœ‰æ²¡æœ‰æƒ³æˆ‘å‘€ï¼ŸğŸ˜Š',
                'ä½ æ˜¯æˆ‘æ¯å¤©æœ€æœŸå¾…è§åˆ°çš„äºº~',
                'å’Œä½ åœ¨ä¸€èµ·çš„æ¯ä¸€å¤©éƒ½å¾ˆå¼€å¿ƒ',
                'è°¢è°¢ä½ ä¸€ç›´é™ªä¼´ç€æˆ‘',
                'æˆ‘è§‰å¾—æˆ‘ä»¬æ˜¯ä¸–ç•Œä¸Šæœ€å¹¸ç¦çš„æƒ…ä¾£',
                'æœŸå¾…ä¸‹æ¬¡è§é¢çš„æ—¶é—´',
                'ä½ çŸ¥é“å—ï¼Ÿæˆ‘æ¯å¤©éƒ½ä¼šæƒ³ä½ å¾ˆå¤šæ¬¡'
            ];
            
            const randomReply = replies[Math.floor(Math.random() * replies.length)];
            
            const newMessage = {
                id: Date.now(),
                sender: 'partner',
                content: randomReply,
                timestamp: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
            };
            
            loveData.messages.push(newMessage);
            localStorage.setItem('loveMessages', JSON.stringify(loveData.messages));
            
            renderChatMessages();
        }

        // åˆå§‹åŒ–æ‹çˆ±é¡¾é—®
        function initAdvisor() {
            const advisorInput = document.getElementById('advisor-input');
            const sendButton = document.getElementById('send-advisor');
            const advisorMessages = document.getElementById('advisor-messages');
            const quickQuestions = document.querySelectorAll('.quick-question');
            
            // å‘é€é—®é¢˜
            function sendQuestion() {
                const question = advisorInput.value.trim();
                if (question) {
                    addUserQuestion(question);
                    advisorInput.value = '';
                    
                    // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥çŠ¶æ€
                    showAdvisorTyping();
                    
                    // å»¶è¿Ÿå›å¤ï¼Œæ¨¡æ‹ŸAIæ€è€ƒ
                    setTimeout(() => {
                        const answer = getAdvisorAnswer(question);
                        addAdvisorAnswer(answer);
                    }, 1500 + Math.random() * 2000);
                }
            }
            
            sendButton.addEventListener('click', sendQuestion);
            advisorInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendQuestion();
                }
            });
            
            // å¿«é€Ÿé—®é¢˜
            quickQuestions.forEach(btn => {
                btn.addEventListener('click', () => {
                    const question = btn.textContent;
                    advisorInput.value = question;
                    sendQuestion();
                });
            });
            
            // æ¸²æŸ“é¡¾é—®æ¶ˆæ¯
            renderAdvisorMessages();
        }

        // æ·»åŠ ç”¨æˆ·é—®é¢˜
        function addUserQuestion(question) {
            const newMessage = {
                id: Date.now(),
                type: 'question',
                content: question,
                timestamp: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
            };
            
            loveData.advisorMessages.push(newMessage);
            localStorage.setItem('loveAdvisorMessages', JSON.stringify(loveData.advisorMessages));
            
            renderAdvisorMessages();
        }

        // æ·»åŠ é¡¾é—®å›ç­”
        function addAdvisorAnswer(answer) {
            const newMessage = {
                id: Date.now(),
                type: 'answer',
                content: answer,
                timestamp: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
            };
            
            loveData.advisorMessages.push(newMessage);
            localStorage.setItem('loveAdvisorMessages', JSON.stringify(loveData.advisorMessages));
            
            renderAdvisorMessages();
        }

        // æ˜¾ç¤ºé¡¾é—®æ­£åœ¨è¾“å…¥
        function showAdvisorTyping() {
            const advisorMessages = document.getElementById('advisor-messages');
            const typingHTML = `
                <div class="flex items-end" id="advisor-typing">
                    <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                        <i class="fa fa-heart"></i>
                    </div>
                    <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm">
                        <div class="typing-indicator">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            `;
            
            advisorMessages.insertAdjacentHTML('beforeend', typingHTML);
            advisorMessages.scrollTop = advisorMessages.scrollHeight;
        }

        // è·å–é¡¾é—®å›ç­”
        function getAdvisorAnswer(question) {
            const answers = {
                'å¦‚ä½•åˆ¶é€ æµªæ¼«æƒŠå–œ': `
è¦åˆ¶é€ æµªæ¼«æƒŠå–œï¼Œé¦–å…ˆè¦äº†è§£å¯¹æ–¹çš„å–œå¥½å’ŒæœŸå¾…ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š

1. **å›å¿†é‡ç°**ï¼šé‡ç°ä½ ä»¬ç¬¬ä¸€æ¬¡è§é¢æˆ–çº¦ä¼šçš„åœºæ™¯ï¼Œå‡†å¤‡ç›¸åŒçš„é£Ÿç‰©ã€éŸ³ä¹æˆ–æ´»åŠ¨ã€‚

2. **æƒŠå–œçº¦ä¼š**ï¼šç­–åˆ’ä¸€åœºå¯¹æ–¹ä¸€ç›´æƒ³å»ä½†æ²¡æœºä¼šå»çš„çº¦ä¼šï¼Œæ¯”å¦‚çƒ­æ°”çƒä¹‹æ—…ã€æ˜Ÿç©ºéœ²è¥æˆ–è€…å»çœ‹ä¸€åœºç‰¹åˆ«çš„æ¼”å‡ºã€‚

3. **æ‰‹å†™æƒ…ä¹¦**ï¼šåœ¨è¿™ä¸ªæ•°å­—åŒ–çš„æ—¶ä»£ï¼Œä¸€å°çœŸæŒšçš„æ‰‹å†™æƒ…ä¹¦ä¼šæ˜¾å¾—æ ¼å¤–çè´µå’Œç”¨å¿ƒã€‚

4. **æƒŠå–œæ´¾å¯¹**ï¼šé‚€è¯·å…±åŒçš„æœ‹å‹ï¼Œä¸ºç‰¹åˆ«çš„æ—¥å­ä¸¾åŠä¸€ä¸ªæƒŠå–œæ´¾å¯¹ï¼Œä½†è¦ç¡®ä¿å¯¹æ–¹å–œæ¬¢è¿™ç§åœºåˆã€‚

5. **æ—¥å¸¸å°æƒŠå–œ**ï¼šä¸ä¸€å®šéè¦å¤§åœºé¢ï¼Œæ—¥å¸¸ä¸­çš„å°æƒŠå–œåŒæ ·é‡è¦ï¼Œæ¯”å¦‚çªç„¶é€èŠ±ã€å‡†å¤‡å¯¹æ–¹å–œæ¬¢çš„é›¶é£Ÿæˆ–è€…å¸®å¿™å®Œæˆä¸€é¡¹å¯¹æ–¹ä¸æƒ³åšçš„ä»»åŠ¡ã€‚

æœ€é‡è¦çš„æ˜¯ï¼ŒæƒŠå–œè¦ä½“ç°å‡ºä½ å¯¹å¯¹æ–¹çš„äº†è§£å’Œå…³å¿ƒï¼Œè€Œä¸æ˜¯ä¸ºäº†æƒŠå–œè€ŒæƒŠå–œã€‚
                `,
                'åµæ¶åå¦‚ä½•å’Œå¥½': `
åµæ¶åå’Œå¥½çš„å…³é”®æ˜¯çœŸè¯šæ²Ÿé€šå’Œäº’ç›¸ç†è§£ï¼š

1. **å†·é™æœŸ**ï¼šç»™å½¼æ­¤ä¸€äº›æ—¶é—´å†·é™ä¸‹æ¥ï¼Œé¿å…åœ¨æƒ…ç»ªæ¿€åŠ¨æ—¶è¯´ä¼¤äººçš„è¯ã€‚

2. **ä¸»åŠ¨æ²Ÿé€š**ï¼šå…ˆæ‰“ç ´æ²‰é»˜ï¼Œè¡¨è¾¾ä½ æƒ³è§£å†³é—®é¢˜çš„æ„æ„¿ã€‚

3. **å€¾å¬å¯¹æ–¹**ï¼šè®¤çœŸå€¾å¬å¯¹æ–¹çš„æ„Ÿå—å’Œæƒ³æ³•ï¼Œä¸è¦æ€¥äºè¾©è§£ã€‚

4. **è¡¨è¾¾æ„Ÿå—**ï¼šç”¨"æˆ‘"çš„è¯­å¥è¡¨è¾¾è‡ªå·±çš„æ„Ÿå—ï¼Œæ¯”å¦‚"æˆ‘æ„Ÿåˆ°éš¾è¿‡"è€Œä¸æ˜¯"ä½ è®©æˆ‘éš¾è¿‡"ã€‚

5. **æ‰¿è®¤é”™è¯¯**ï¼šçœŸè¯šåœ°æ‰¿è®¤è‡ªå·±çš„é”™è¯¯ï¼Œä¸è¦æ‰¾å€Ÿå£ã€‚

6. **å¯»æ±‚å…±è¯†**ï¼šä¸€èµ·è®¨è®ºå¦‚ä½•é¿å…ç±»ä¼¼é—®é¢˜å†æ¬¡å‘ç”Ÿã€‚

7. **é‡å»ºè¿æ¥**ï¼šå’Œå¥½åï¼Œå¯ä»¥é€šè¿‡ä¸€äº›äº²å¯†çš„ä¸¾åŠ¨é‡å»ºæƒ…æ„Ÿè¿æ¥ï¼Œæ¯”å¦‚æ‹¥æŠ±ã€äº²å»æˆ–è€…ä¸€èµ·åšå–œæ¬¢çš„äº‹æƒ…ã€‚

è®°ä½ï¼Œåµæ¶æœ¬èº«å¹¶ä¸æ˜¯åäº‹ï¼Œå…³é”®æ˜¯å¦‚ä½•é€šè¿‡åµæ¶æ›´å¥½åœ°äº†è§£å½¼æ­¤ï¼Œè®©å…³ç³»æ›´åŠ ç‰¢å›ºã€‚
                `,
                'çºªå¿µæ—¥ç¤¼ç‰©æ¨è': `
çºªå¿µæ—¥ç¤¼ç‰©æœ€é‡è¦çš„æ˜¯ä½“ç°å¿ƒæ„å’Œå¯¹å¯¹æ–¹çš„äº†è§£ï¼š

**ç»™å¥³æœ‹å‹çš„ç¤¼ç‰©å»ºè®®ï¼š**
- ç å®é¦–é¥°ï¼ˆé¡¹é“¾ã€æ‰‹é“¾ç­‰ï¼Œæœ€å¥½æœ‰ç‰¹æ®Šå«ä¹‰ï¼‰
- å®šåˆ¶ç›¸å†Œæˆ–å›å¿†å½•
- é«˜çº§æŠ¤è‚¤å“æˆ–é¦™æ°´
- æ‰‹å·¥è‰ºå“æˆ–DIYç¤¼ç‰©
- æ—…è¡Œè®¡åˆ’æˆ–ä½“éªŒæ´»åŠ¨

**ç»™ç”·æœ‹å‹çš„ç¤¼ç‰©å»ºè®®ï¼š**
- ç§‘æŠ€äº§å“æˆ–é…ä»¶
- å®šåˆ¶çš„æƒ…ä¾£ç‰©å“
- ä»–å–œæ¬¢çš„è¿åŠ¨è£…å¤‡
- ç²¾è‡´çš„æ‰‹è¡¨æˆ–é’±åŒ…
- ä¸€èµ·çš„å†’é™©ä½“éªŒ

**é€šç”¨å»ºè®®ï¼š**
1. è€ƒè™‘å¯¹æ–¹çš„å…´è¶£çˆ±å¥½
2. åŠ å…¥ä¸ªäººåŒ–å…ƒç´ ï¼Œæ¯”å¦‚åˆ»å­—ã€ç…§ç‰‡ç­‰
3. ç¤¼ç‰©ä¸åœ¨è´µé‡ï¼Œåœ¨äºç”¨å¿ƒ
4. å¯ä»¥ç»“åˆç¤¼ç‰©å’Œç‰¹åˆ«çš„ä½“éªŒï¼Œè®©çºªå¿µæ—¥æ›´åŠ éš¾å¿˜

æœ€é‡è¦çš„æ˜¯ï¼Œç¤¼ç‰©åªæ˜¯è¡¨è¾¾çˆ±æ„çš„æ–¹å¼ä¹‹ä¸€ï¼ŒçœŸè¯šçš„é™ªä¼´å’Œç†è§£æ‰æ˜¯æœ€å¥½çš„ç¤¼ç‰©ã€‚
                `
            };
            
            // æ£€æŸ¥æ˜¯å¦æœ‰é¢„è®¾å›ç­”
            for (const [key, answer] of Object.entries(answers)) {
                if (question.includes(key)) {
                    return answer.trim();
                }
            }
            
            // é»˜è®¤å›ç­”
            const defaultAnswers = [
                `äº²çˆ±çš„æƒ…ä¾£ä»¬ï¼Œæ„Ÿè°¢ä½ ä»¬çš„é—®é¢˜ï¼çˆ±æƒ…æ˜¯éœ€è¦ç”¨å¿ƒç»è¥çš„ï¼Œæ¯ä¸€æ®µå…³ç³»éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç¾ä¸½ã€‚

è®°ä½ï¼Œæœ€é‡è¦çš„æ˜¯å½¼æ­¤çš„ç†è§£ã€å°Šé‡å’ŒåŒ…å®¹ã€‚åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­å¤šä¸€äº›å°æƒŠå–œï¼Œå¤šä¸€äº›çœŸè¯šçš„æ²Ÿé€šï¼Œå¤šä¸€äº›äº’ç›¸æ”¯æŒï¼Œçˆ±æƒ…ä¹‹èŠ±å°±ä¼šè¶Šå¼€è¶Šè‰³ã€‚

ä½ ä»¬è¿˜æœ‰ä»€ä¹ˆå…·ä½“çš„é—®é¢˜æƒ³è¦å’¨è¯¢å—ï¼Ÿæˆ‘å¾ˆä¹æ„ç»§ç»­ä¸ºä½ ä»¬æä¾›å»ºè®®å’Œæ”¯æŒï¼`,
                
                `ä½œä¸ºæ‹çˆ±é¡¾é—®ï¼Œæˆ‘æƒ³å‘Šè¯‰ä½ ä»¬ï¼Œæ¯æ®µæ„Ÿæƒ…éƒ½æ˜¯ç‹¬ç‰¹çš„æ—…ç¨‹ã€‚é‡è¦çš„ä¸æ˜¯å®Œç¾æ— ç¼ºï¼Œè€Œæ˜¯åœ¨å½¼æ­¤çš„é™ªä¼´ä¸­ä¸€èµ·æˆé•¿ã€‚

åœ¨æ‹çˆ±ä¸­ï¼Œæ²Ÿé€šæ˜¯æ¡¥æ¢ï¼Œç†è§£æ˜¯åŸºçŸ³ï¼ŒåŒ…å®¹æ˜¯è‰¯è¯ã€‚è®°å¾—ç»å¸¸è¡¨è¾¾çˆ±æ„ï¼Œä¸è¦æŠŠå¯¹æ–¹çš„å¥½å½“æˆç†æ‰€å½“ç„¶ã€‚

çæƒœæ¯ä¸€ä¸ªç›¸å¤„çš„ç¬é—´ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯æ„æˆç¾å¥½å›å¿†çš„é‡è¦ç‰‡æ®µã€‚ç¥ä½ ä»¬çš„çˆ±æƒ…ç”œèœœé•¿ä¹…ï¼`,
                
                `äº²çˆ±çš„ï¼Œçˆ±æƒ…æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œéœ€è¦ä¸¤ä¸ªäººå…±åŒåˆ›ä½œç¾ä¸½çš„ç”»å·ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæœ‰è‰²å½©é²œè‰³çš„æ—¶åˆ»ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰éœ€è¦è°ƒå’Œçš„åœ°æ–¹ã€‚é‡è¦çš„æ˜¯ä¿æŒè€å¿ƒå’Œä¿¡å¿ƒï¼Œç›¸ä¿¡å½¼æ­¤çš„æ„Ÿæƒ…ã€‚

è®°ä½ç»å¸¸ç»™å¯¹æ–¹ä¸€äº›å°æƒŠå–œï¼Œè¡¨è¾¾ä½ çš„çˆ±æ„å’Œå…³å¿ƒã€‚ä¸€ä¸ªæ¸©æš–çš„æ‹¥æŠ±ï¼Œä¸€å¥è´´å¿ƒçš„è¯è¯­ï¼Œä¸€ä¸ªç†è§£çš„çœ¼ç¥ï¼Œéƒ½èƒ½è®©çˆ±æƒ…æ›´åŠ ç”œèœœã€‚

ä½ ä»¬çš„çˆ±æƒ…æ•…äº‹æ­£åœ¨ç»§ç»­ä¹¦å†™ï¼Œæ¯ä¸€é¡µéƒ½å€¼å¾—ç”¨å¿ƒå¯¹å¾…ï¼`
            ];
            
            return defaultAnswers[Math.floor(Math.random() * defaultAnswers.length)];
        }

        // æ¸²æŸ“é¡¾é—®æ¶ˆæ¯
        function renderAdvisorMessages() {
            const advisorMessages = document.getElementById('advisor-messages');
            
            // ç§»é™¤æ­£åœ¨è¾“å…¥çŠ¶æ€
            const typingElement = document.getElementById('advisor-typing');
            if (typingElement) {
                typingElement.remove();
            }
            
            if (loveData.advisorMessages.length === 0) {
                advisorMessages.innerHTML = `
                    <div class="flex justify-center items-center h-full">
                        <div class="text-center text-gray-500">
                            <i class="fa fa-heart text-4xl mb-3"></i>
                            <p>æœ‰ä»€ä¹ˆæ‹çˆ±é—®é¢˜æƒ³è¦å’¨è¯¢å—ï¼Ÿ</p>
                        </div>
                    </div>
                `;
                return;
            }
            
            advisorMessages.innerHTML = loveData.advisorMessages.map(msg => {
                if (msg.type === 'question') {
                    return `
                        <div class="flex items-end justify-end">
                            <div class="chat-bubble-right bg-primary p-3 rounded-lg shadow-sm text-white max-w-xs md:max-w-md">
                                <p>${msg.content}</p>
                                <span class="text-xs text-gray-200 mt-1 block">${msg.timestamp}</span>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white ml-2 flex-shrink-0">
                                <span>æˆ‘</span>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="flex items-end">
                            <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white mr-2 flex-shrink-0">
                                <i class="fa fa-heart"></i>
                            </div>
                            <div class="chat-bubble-left bg-white p-3 rounded-lg shadow-sm max-w-xs md:max-w-md">
                                <p class="text-gray-800 whitespace-pre-line">${msg.content}</p>
                                <span class="text-xs text-gray-500 mt-1 block">${msg.timestamp}</span>
                            </div>
                        </div>
                    `;
                }
            }).join('');
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            advisorMessages.scrollTop = advisorMessages.scrollHeight;
        }

        // åŠ è½½ç”¨æˆ·æ•°æ®
        function loadUserData() {
            // åŠ è½½å¤´åƒ
            if (loveData.avatar) {
                document.getElementById('couple-avatar').src = loveData.avatar;
            }
            
            // åŠ è½½èƒŒæ™¯
            if (loveData.background) {
                const backgroundImage = document.getElementById('background-image');
                backgroundImage.style.backgroundImage = `url(${loveData.background})`;
                backgroundImage.style.opacity = '0.3';
            }
        }

        // æ¨¡æ‹Ÿå¯¹æ–¹åœ¨çº¿çŠ¶æ€
        function simulatePartnerOnline() {
            const partnerStatus = document.getElementById('partner-status');
            const statusText = partnerStatus.nextElementSibling;
            
            // éšæœºæ¨¡æ‹Ÿåœ¨çº¿çŠ¶æ€å˜åŒ–
            setInterval(() => {
                loveData.partnerOnline = Math.random() > 0.3; // 70%æ¦‚ç‡åœ¨çº¿
                localStorage.setItem('lovePartnerOnline', loveData.partnerOnline);
                
                if (loveData.partnerOnline) {
                    partnerStatus.className = 'inline-block w-3 h-3 rounded-full bg-online mr-2';
                    statusText.textContent = 'å¯¹æ–¹åœ¨çº¿';
                    statusText.className = 'text-sm text-gray-600';
                } else {
                    partnerStatus.className = 'inline-block w-3 h-3 rounded-full bg-offline mr-2';
                    statusText.textContent = 'å¯¹æ–¹ç¦»çº¿';
                    statusText.className = 'text-sm text-gray-400';
                }
            }, 10000); // æ¯10ç§’æ›´æ–°ä¸€æ¬¡
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message) {
            // åˆ›å»ºæç¤ºå…ƒç´ 
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-white text-gray-800 px-4 py-2 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full opacity-0 z-50';
            toast.textContent = message;
            
            // æ·»åŠ åˆ°é¡µé¢
            document.body.appendChild(toast);
            
            // æ˜¾ç¤ºæç¤º
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
                toast.classList.add('translate-x-0', 'opacity-100');
            }, 10);
            
            // 3ç§’åéšè—
            setTimeout(() => {
                toast.classList.remove('translate-x-0', 'opacity-100');
                toast.classList.add('translate-x-full', 'opacity-0');
                
                // ç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>